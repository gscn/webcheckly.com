# 深度检查使用指南

## 概述

深度检查功能使用 Katana 工具对目标网站进行深度链接检查，发现页面中的所有链接和资源。与快速扫描不同，深度检查专注于使用专业工具进行更深入的链接发现和分析。

## 快速扫描 vs 深度检查

### 快速扫描
- **工具**：内置工具（httpx、Go标准库等）
- **速度**：快速（通常10-30秒）
- **适用场景**：日常检测、快速了解网站基本信息
- **特点**：轻量级、无额外依赖

### 深度检查
- **工具**：Katana（专业链接发现工具）
- **速度**：较慢（通常30-120秒）
- **适用场景**：深度链接分析、API端点发现、网站结构分析
- **特点**：更深入的链接发现、需要安装额外工具

## 工具说明

### Katana - 深度链接检查

**功能**：
- 发现页面中的所有链接和资源
- 发现隐藏的API端点
- 发现目录结构
- 获取资源类型和状态码
- 支持深度爬取

**优势**：
- 专业的爬取能力
- 可以发现更多资源
- 支持深度爬取
- 自动识别资源类型

**使用场景**：
- 安全测试
- 网站结构分析
- API端点发现
- 链接完整性检查

## 使用方法

### 前端使用

1. **访问深度检查页面**
   - 在导航菜单中点击"深度检查"
   - 或直接访问 `/deep-scan`

2. **输入目标URL**
   - 在输入框中输入要检测的网站URL
   - 点击"开始深度检查"按钮

3. **查看执行状态**
   - 实时查看 Katana 的执行状态和进度
   - 查看错误信息（如有）

4. **查看结果**
   - **发现的链接和资源**：完整的链接列表
   - **统计信息**：总计、成功、错误链接数量
   - **过滤和搜索**：支持按类型、状态筛选，以及关键词搜索
   - **链接健康检查**：自动转换为链接健康检查格式

### API使用

创建深度检查任务：

```bash
POST /api/scans
Content-Type: application/json

{
  "url": "https://example.com",
  "options": ["katana"],
  "language": "zh"
}
```

查询任务状态：

```bash
GET /api/scans/{taskId}
```

获取任务结果：

```bash
GET /api/scans/{taskId}/results
```

## 结果说明

### Katana结果

- **URL列表**：发现的页面和资源
- **资源类型**：HTML、CSS、JS、图片等
- **状态码**：HTTP响应状态码（200-399为成功，400+为错误）
- **标题**：页面标题（如有）
- **响应时间**：资源加载时间

### 结果统计

- **总计**：发现的链接总数
- **成功**：状态码在200-399范围内的链接数量
- **错误**：状态码在400及以上的链接数量

### 过滤和搜索

- **按类型筛选**：根据资源类型（HTML、CSS、JS等）筛选
- **按状态筛选**：根据状态码筛选（成功/错误）
- **关键词搜索**：在URL或标题中搜索关键词

## 结果自动合并

深度检查模式下，结果会自动合并为统一格式：

- **Katana → LinkHealth**：资源发现结果转换为链接健康检查格式

这样可以在前端统一展示，同时保留原始详细数据。

## 工具安装

### Katana

```bash
# 使用Go安装
go install github.com/projectdiscovery/katana/cmd/katana@latest

# 或下载预编译二进制
# https://github.com/projectdiscovery/katana/releases

# 验证安装
katana -version
```

**Windows 用户**：请参考 [Windows 调试指南](./Windows调试指南.md) 获取详细的安装和调试说明。

## 注意事项

1. **工具依赖**：确保 Katana 已正确安装并在 PATH 中
2. **执行时间**：深度检查可能需要较长时间（30-120秒），取决于网站大小
3. **资源消耗**：Katana 可能消耗较多系统资源
4. **网络要求**：需要稳定的网络连接
5. **权限要求**：某些网站可能需要特定权限才能访问

## 常见问题

### Q: 工具未找到错误

A: 确保 Katana 已安装并在系统 PATH 中。可以使用以下命令检查：
```bash
katana -version
```

如果未安装，请参考上面的安装说明。

### Q: 检查时间过长

A: 这是正常的，深度检查需要更多时间进行详细检测。可以：
- 检查网络连接
- 确认目标网站可访问
- 查看工具日志了解进度

### Q: 没有发现任何链接

A: 可能的原因：
- 目标网站需要登录才能访问
- 网站使用了反爬虫机制
- 网站结构特殊，Katana 无法识别
- 网络连接问题

### Q: 结果不准确

A: Katana 的检测结果取决于：
- 网站结构
- 链接格式
- 反爬虫机制
- 网络环境

建议结合快速扫描的结果进行对比分析。

## 最佳实践

1. **选择合适的检查目标**
   - 选择公开可访问的网站
   - 避免检查需要登录的网站
   - 注意遵守网站的 robots.txt

2. **理解结果**
   - 关注状态码为200-399的成功链接
   - 检查400+的错误链接，可能是需要修复的问题
   - 利用过滤和搜索功能快速定位关键信息

3. **结合其他功能**
   - 可以结合快速扫描的结果
   - 使用链接健康检查功能验证链接状态
   - 查看网站信息了解整体情况

## 技术细节

### 工作原理

1. Katana 工具对目标URL进行深度爬取
2. 发现页面中的所有链接和资源
3. 获取每个资源的详细信息（类型、状态码、标题等）
4. 结果自动转换为链接健康检查格式
5. 在前端统一展示

### 性能优化

- 使用并发处理提高效率
- 自动去重避免重复检查
- 支持超时控制
- 结果缓存机制

## 故障排除

如果遇到问题，请：

1. 检查 Katana 是否正确安装
2. 查看后端日志了解详细错误信息
3. 确认目标URL可访问
4. 检查网络连接
5. 参考 [Windows 调试指南](./Windows调试指南.md)（Windows用户）

## 更新日志

- **v1.0**：初始版本，支持 Katana 深度链接检查
- 专注于链接发现和分析
- 优化的UI和交互体验
